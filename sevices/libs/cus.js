"use strict";angular.module("sendpulse",["sendpulse.authManager"]),angular.module("sendpulse.authManager",["angular-jwt","ngCookies"]).provider("authManager",function(){this.$get=["$window","$http","$q","$cookies","jwtHelper",function(r,t,n,o,e){var a={},u="/oauth/refresh/",s="/logout/",i="oauth_access_token",c="oauth_refresh_token";function h(e){return o.put(i,e.data.data.access_token,{path:"/"}),o.put(c,e.data.data.refresh_token,{path:"/"}),r.promiseJWT=null,e.data.data.access_token}return a.logout=function(){return o.remove(i,{path:"/"}),o.remove(c,{path:"/"}),r.promiseJWT=null,document.location=s,null},a.getAccessToken=function(){return o.get(i)},a.getRefreshToken=function(){return o.get(c)},a.isTokens=function(){return a.getAccessToken()&&a.getRefreshToken()&&!0},a.isTokenExpired=function(){return e.isTokenExpired(a.getAccessToken(),60)},a.access=function(){if(!a.isTokens())return a.logout();if(!a.isTokenExpired())return n(function(e){return e(a.getAccessToken())}).then(function(e){return e});var e={url:u,skipAuthorization:!0,method:"POST",data:{refresh_token:a.getRefreshToken()}};return r.promiseJWT=r.promiseJWT?r.promiseJWT:t(e).then(h).catch(a.logout)},Object.freeze(a),a}]}),function(){angular.module("jQueryApp",["sendpulse.authManager"]);var a=angular.injector(["jQueryApp"]).get("authManager");jQuery.ajaxPrefilter(function(e,r,t){var n=!e.skipAuthorization&&void 0!==e.skipAuthorization;n&&t.setRequestHeader("Authorization","Bearer "+a.getAccessToken()),n&&!a.isTokens()&&(t.abort(),a.logout()),r.error&&(r._error=r.error),e.error=jQuery.noop();var o=jQuery.Deferred();return t.done(o.resolve),t.fail(function(){var e=Array.prototype.slice.call(arguments);r._refreshToken?a.access().then(function(){delete r._refreshToken,jQuery.ajax(r).then(o.resolve,o.reject)}):(r._error&&o.fail(r._error),o.rejectWith(t,e))}),n&&a.isTokenExpired()&&(r._refreshToken=!0,t.abort()),o.promise(t)})}();